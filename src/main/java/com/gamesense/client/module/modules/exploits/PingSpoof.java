package com.gamesense.client.module.modules.exploits;

import com.gamesense.api.event.events.PacketEvent;
import com.gamesense.api.setting.values.DoubleSetting;
import com.gamesense.api.util.misc.Timer;
import com.gamesense.client.module.Category;
import com.gamesense.client.module.Module;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.network.play.client.CPacketKeepAlive;

@Module.Declaration(name = "PingSpoof", category = Category.Exploits)
public class PingSpoof extends Module {

    DoubleSetting ping = registerDouble("Ping", 100,1,1000);

    Timer timer = new Timer();

    CPacketKeepAlive cPacketKeepAlive = null;

    @EventHandler
    private final Listener<PacketEvent.Send> listener = new Listener<>(event -> {
        if(event.getPacket() instanceof CPacketKeepAlive && cPacketKeepAlive != event.getPacket() && ping.getValue() != 0) {
            cPacketKeepAlive = (CPacketKeepAlive) event.getPacket();
            event.cancel();
            timer.reset();
        }
    });

    public String getHudInfo() {
        return ping.getValue() + "ms";
    }

    public void onUpdate() {
        if(timer.hasReached(ping.getValue().longValue()) && cPacketKeepAlive != null) {
            mc.player.connection.sendPacket(cPacketKeepAlive);
            cPacketKeepAlive = null;
        }
    }

}
